### SAVORY AI - ПОЛНОЕ ТЕСТИРОВАНИЕ СЕРВИСА
### Запускай запросы последовательно сверху вниз
### Все ID динамические через client.global.set()

@baseUrl = http://localhost:4000

### 0.1 Ping сервера
GET {{baseUrl}}/ping

> {%
    client.test("Ping returns Pong", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 1.1 Регистрация нового пользователя
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "company": "La Bella Italia",
  "name": "Mario Rossi",
  "email": "mario{{$timestamp}}@labellaitalia.com",
  "phone": "+390123456789",
  "password": "Qwerty12"
}

> {%
    client.test("Registration successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    // Registration returns RegisterResponse: id, email, name, company, phone
    // No token - need to login after registration
    if (response.body.data) {
        client.global.set("user_id", response.body.data.id);
        client.global.set("user_email", response.body.data.email);
    }
%}

### 1.2 Логин (используем email из регистрации)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{user_email}}",
  "password": "Qwerty12"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data) {
        client.global.set("token", response.body.data.token);
        if (response.body.data.user) {
            client.global.set("user_id", response.body.data.user.id);
            client.global.set("user_email", response.body.data.user.email);
        }
        if (response.body.data.organization) {
            client.global.set("organization_id", response.body.data.organization.id);
        } else if (response.body.data.user && response.body.data.user.organization_id) {
            client.global.set("organization_id", response.body.data.user.organization_id);
        }
    }
%}

### 1.3 Логин с неверным паролем
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{user_email}}",
  "password": "wrongpassword"
}

> {%
    client.test("Invalid login returns error", function() {
        client.assert(response.status === 401 || response.status === 400, "Expected error");
    });
%}

### 1.4 Проверка авторизации
GET {{baseUrl}}/auth/chek
Authorization: Bearer {{token}}

> {%
    client.test("Auth check successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 1.5 Проверка без токена
GET {{baseUrl}}/auth/chek

> {%
    client.test("Unauthorized without token", function() {
        client.assert(response.status === 401, "Expected 401");
    });
%}

### 2.1 Получить организации
GET {{baseUrl}}/organization
Authorization: Bearer {{token}}

> {%
    client.test("Get organizations successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && Array.isArray(response.body.data) && response.body.data.length > 0) {
        client.global.set("organization_id", response.body.data[0].id);
    }
%}

### 2.2 Получить организацию по ID
GET {{baseUrl}}/organization/{{organization_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Get organization by ID successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 2.3 Обновить организацию
PATCH {{baseUrl}}/organization/{{organization_id}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "La Bella Italia Restaurant Group",
  "phone": "+390123456700"
}

> {%
    client.test("Update organization successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 3.1 Создать русский язык
POST {{baseUrl}}/languages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "code": "ru",
  "name": "Русский",
  "description": "Russian language"
}

> {%
    client.test("Create language", function() {
        client.assert(response.status === 200 || response.status === 201 || response.status === 400, "Expected success or exists");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("language_ru_id", response.body.data.id);
    }
%}

### 3.2 Создать английский язык
POST {{baseUrl}}/languages
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "code": "en",
  "name": "English",
  "description": "English language"
}

> {%
    client.test("Create English language", function() {
        client.assert(response.status === 200 || response.status === 201 || response.status === 400, "Expected success or exists");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("language_en_id", response.body.data.id);
    }
%}

### 3.3 Получить все языки
GET {{baseUrl}}/languages
Authorization: Bearer {{token}}

> {%
    client.test("Get languages successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && response.body.data.length > 0) {
        client.global.set("language_ru_id", response.body.data[0].id);
    }
%}

### 4.1 Создать ресторан
POST {{baseUrl}}/restaurants
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "organization_id": {{organization_id}},
  "name": "La Bella Italia - Centro",
  "address": "Via Roma, 15, 00184 Roma RM, Italy",
  "phone": "+39 06 1234567",
  "website": "https://labellaitalia.com",
  "description": "Аутентичный итальянский ресторан",
  "image_url": "https://example.com/restaurant.jpg",
  "reservation_duration": 90,
  "working_hours": [
    {"day_of_week": 0, "open_time": "12:00", "close_time": "23:00"},
    {"day_of_week": 1, "open_time": "12:00", "close_time": "23:00"},
    {"day_of_week": 2, "open_time": "12:00", "close_time": "23:00"},
    {"day_of_week": 3, "open_time": "12:00", "close_time": "23:00"},
    {"day_of_week": 4, "open_time": "12:00", "close_time": "23:30"},
    {"day_of_week": 5, "open_time": "12:00", "close_time": "00:00"},
    {"day_of_week": 6, "open_time": "12:00", "close_time": "00:00"}
  ]
}

> {%
    client.test("Create restaurant successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("restaurant_id", response.body.data.id);
    }
%}

### 4.2 Получить все рестораны
GET {{baseUrl}}/restaurants
Authorization: Bearer {{token}}

> {%
    client.test("Get restaurants successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && response.body.data.length > 0 && !client.global.get("restaurant_id")) {
        client.global.set("restaurant_id", response.body.data[0].id);
    }
%}

### 4.3 Получить ресторан по ID
GET {{baseUrl}}/restaurants/{{restaurant_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Get restaurant by ID successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 5.1 Создать столик на 2 гостя
POST {{baseUrl}}/tables
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Столик №1 (Романтический)",
  "guestCount": 2,
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Creates table successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("table_id", response.body.data.id);
        client.global.set("table_id_1", response.body.data.id);
    }
%}

### 5.2 Создать столик на 4 гостя
POST {{baseUrl}}/tables
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Столик №2",
  "guestCount": 4,
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Create 4-person table successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("table_id_2", response.body.data.id);
    }
%}

### 5.3 Создать столик на 6 гостей
POST {{baseUrl}}/tables
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Столик №3 (Семейный)",
  "guestCount": 6,
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Create 6-person table successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("table_id_3", response.body.data.id);
    }
%}

### 5.4 Создать VIP столик
POST {{baseUrl}}/tables
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "VIP столик",
  "guestCount": 8,
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Create VIP table successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("table_id_4", response.body.data.id);
    }
%}

### 5.5 Получить все столики
GET {{baseUrl}}/tables
Authorization: Bearer {{token}}

> {%
    client.test("Get tables successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && response.body.data.length > 0 && !client.global.get("table_id")) {
        client.global.set("table_id", response.body.data[0].id);
    }
%}

### 5.6 Получить столики ресторана
GET {{baseUrl}}/tables/restaurant/{{restaurant_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Get restaurant tables successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 6.1 Создать категорию Закуски
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Закуски (Antipasti)"
}

> {%
    client.test("Create Antipasti category successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("category_antipasti_id", response.body.data.id);
    }
%}

### 6.2 Создать категорию Паста
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Первые блюда (Primi Piatti)"
}

> {%
    client.test("Create Primi category successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("category_primi_id", response.body.data.id);
    }
%}

### 6.3 Создать категорию Вторые блюда
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Вторые блюда (Secondi Piatti)"
}

> {%
    client.test("Create Secondi category successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("category_secondi_id", response.body.data.id);
    }
%}

### 6.4 Создать категорию Десерты
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Десерты (Dolci)"
}

> {%
    client.test("Create Dolci category successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("category_dolci_id", response.body.data.id);
    }
%}

### 6.5 Создать категорию Напитки
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Напитки (Bevande)"
}

> {%
    client.test("Create Bevande category successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("category_bevande_id", response.body.data.id);
    }
%}

### 6.6 Создать категорию Пицца
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Пицца"
}

> {%
    client.test("Create Pizza category successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("category_pizza_id", response.body.data.id);
    }
%}

### 6.7 Получить все категории
GET {{baseUrl}}/categories
Authorization: Bearer {{token}}

> {%
    client.test("Get categories successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && response.body.data.length > 0) {
        response.body.data.forEach(function(cat, index) {
            if (index === 0 && !client.global.get("category_antipasti_id")) {
                client.global.set("category_antipasti_id", cat.id);
            }
        });
    }
%}

### 7.1 Создать Брускетту
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_antipasti_id}},
  "name": "Брускетта с томатами и базиликом",
  "price": 450,
  "description": "Хрустящий итальянский хлеб с томатами, базиликом и оливковым маслом",
  "image": "https://example.com/bruschetta.jpg",
  "ingredients": [
    {"name": "Чиабатта", "quantity": 100},
    {"name": "Томаты черри", "quantity": 80},
    {"name": "Базилик", "quantity": 10}
  ],
  "allergens": [
    {"name": "Глютен", "description": "Содержится в хлебе"}
  ]
}

> {%
    client.test("Create Bruschetta successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("dish_bruschetta_id", response.body.data.id);
        client.global.set("dish_id", response.body.data.id);
    }
%}

### 7.2 Создать Карпаччо
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_antipasti_id}},
  "name": "Карпаччо из говядины",
  "price": 890,
  "description": "Тонко нарезанная говядина с рукколой и пармезаном",
  "image": "https://example.com/carpaccio.jpg",
  "ingredients": [
    {"name": "Говядина", "quantity": 120},
    {"name": "Руккола", "quantity": 30},
    {"name": "Пармезан", "quantity": 25}
  ],
  "allergens": [
    {"name": "Молоко", "description": "Содержится в пармезане"}
  ]
}

> {%
    client.test("Create Carpaccio successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("dish_carpaccio_id", response.body.data.id);
    }
%}

### 8.1 Создать Карбонару
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_primi_id}},
  "name": "Спагетти Карбонара",
  "price": 690,
  "description": "Классическая римская паста с гуанчиале и яйцом",
  "image": "https://example.com/carbonara.jpg",
  "ingredients": [
    {"name": "Спагетти", "quantity": 150},
    {"name": "Гуанчиале", "quantity": 80},
    {"name": "Яичный желток", "quantity": 40},
    {"name": "Пекорино Романо", "quantity": 40}
  ],
  "allergens": [
    {"name": "Глютен", "description": "Содержится в пасте"},
    {"name": "Яйца", "description": "Входят в соус"},
    {"name": "Молоко", "description": "Содержится в сыре"}
  ]
}

> {%
    client.test("Create Carbonara successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("dish_carbonara_id", response.body.data.id);
    }
%}

### 8.2 Создать Ризотто
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_primi_id}},
  "name": "Ризотто с белыми грибами",
  "price": 850,
  "description": "Кремовое ризотто с белыми грибами",
  "image": "https://example.com/risotto.jpg",
  "ingredients": [
    {"name": "Рис Арборио", "quantity": 120},
    {"name": "Белые грибы", "quantity": 60},
    {"name": "Пармезан", "quantity": 30}
  ],
  "allergens": [
    {"name": "Молоко", "description": "Содержится в сыре"}
  ]
}

> {%
    client.test("Create Risotto successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });
%}

### 9.1 Создать Оссобуко
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_secondi_id}},
  "name": "Оссобуко по-милански",
  "price": 1450,
  "description": "Телячья голень в белом вине",
  "image": "https://example.com/ossobuco.jpg",
  "ingredients": [
    {"name": "Телячья голень", "quantity": 350},
    {"name": "Белое вино", "quantity": 100}
  ],
  "allergens": []
}

> {%
    client.test("Create Ossobuco successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });
%}

### 10.1 Создать Тирамису
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_dolci_id}},
  "name": "Тирамису классический",
  "price": 420,
  "description": "Итальянский десерт с маскарпоне",
  "image": "https://example.com/tiramisu.jpg",
  "ingredients": [
    {"name": "Маскарпоне", "quantity": 120},
    {"name": "Савоярди", "quantity": 80},
    {"name": "Эспрессо", "quantity": 60}
  ],
  "allergens": [
    {"name": "Глютен", "description": "Содержится в печенье"},
    {"name": "Молоко", "description": "Содержится в маскарпоне"},
    {"name": "Яйца", "description": "Входят в крем"}
  ]
}

> {%
    client.test("Create Tiramisu successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });
%}

### 11.1 Создать Эспрессо
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_bevande_id}},
  "name": "Эспрессо",
  "price": 150,
  "description": "Классический итальянский эспрессо",
  "image": "https://example.com/espresso.jpg",
  "ingredients": [
    {"name": "Кофе арабика", "quantity": 7}
  ],
  "allergens": []
}

> {%
    client.test("Create Espresso successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });
%}

### 12.1 Создать Пиццу Маргарита
POST {{baseUrl}}/dishes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_pizza_id}},
  "name": "Пицца Маргарита",
  "price": 550,
  "description": "Классическая пицца с моцареллой",
  "image": "https://example.com/margherita.jpg",
  "ingredients": [
    {"name": "Тесто", "quantity": 250},
    {"name": "Томатный соус", "quantity": 80},
    {"name": "Моцарелла", "quantity": 150}
  ],
  "allergens": [
    {"name": "Глютен", "description": "Содержится в тесте"},
    {"name": "Молоко", "description": "Содержится в сыре"}
  ]
}

> {%
    client.test("Create Margherita successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });
%}

### 13.1 Получить все блюда
GET {{baseUrl}}/dishes
Authorization: Bearer {{token}}

> {%
    client.test("Get all dishes successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && response.body.data.length > 0 && !client.global.get("dish_id")) {
        client.global.set("dish_id", response.body.data[0].id);
    }
%}

### 13.2 Получить блюда по категории
GET {{baseUrl}}/dishes/category?categoryId={{category_antipasti_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Get dishes by category successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 13.3 Получить блюдо по ID
GET {{baseUrl}}/dishes/{{dish_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Get dish by ID successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 13.4 Установить блюдо дня
POST {{baseUrl}}/dishes/dish-of-day/{{dish_carbonara_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Set dish of day successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 13.5 Получить блюдо дня
GET {{baseUrl}}/dishes/dish-of-day
Authorization: Bearer {{token}}

> {%
    client.test("Get dish of day successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 14.1 Создать вопрос о меню
POST {{baseUrl}}/questions
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "text": "Какие блюда есть в меню?",
  "languageCode": "ru",
  "chatType": "menu"
}

> {%
    client.test("Create question successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("question_id", response.body.data.id);
    }
%}

### 14.2 Создать вопрос о бронировании
POST {{baseUrl}}/questions
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "text": "Хочу забронировать столик",
  "languageCode": "ru",
  "chatType": "reservation"
}

> {%
    client.test("Create reservation question successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });
%}

### 14.3 Получить все вопросы
GET {{baseUrl}}/questions
Authorization: Bearer {{token}}

> {%
    client.test("Get questions successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 15.1 Получить QR-код ресторана
GET {{baseUrl}}/qrcodes/restaurant/{{restaurant_id}}

> {%
    client.test("Get restaurant QR code", function() {
        client.assert(response.status === 200 || response.status === 404, "Expected 200 or 404");
    });
%}

### 15.2 Получить QR-код столика
GET {{baseUrl}}/qrcodes/restaurant/{{restaurant_id}}/table/{{table_id}}

> {%
    client.test("Get table QR code", function() {
        client.assert(response.status === 200 || response.status === 404, "Expected 200 or 404");
    });
%}

### 16.1 Начать сессию чата
POST {{baseUrl}}/chat/restaurant/session/start
Content-Type: application/json

{
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Start chat session successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data) {
        client.global.set("chat_session_id", response.body.data.session.id);
    }
%}

### 16.2 Отправить сообщение в чат
POST {{baseUrl}}/chat/restaurant/message/send
Content-Type: application/json

{
  "sessionId": {{chat_session_id}},
  "content": "Какие у вас есть пасты?"
}

> {%
    client.test("Send message successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 16.3 Получить историю сообщений
GET {{baseUrl}}/chat/restaurant/session/{{chat_session_id}}/messages

> {%
    client.test("Get chat history successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 17.1 Начать сессию чата для столика
POST {{baseUrl}}/chat/table/session/start
Content-Type: application/json

{
  "tableId": {{table_id}},
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Start table chat session successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data) {
        client.global.set("table_chat_session_id", response.body.data.session.id);
    }
%}

### 17.2 Отправить сообщение в чат столика
POST {{baseUrl}}/chat/table/message/send
Content-Type: application/json

{
  "sessionId": {{table_chat_session_id}},
  "content": "Какие у вас десерты?"
}

> {%
    client.test("Send table message successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 18.1 Получить доступные слоты
GET {{baseUrl}}/reservations/available/{{restaurant_id}}?date=2025-12-01&guest_count=2

> {%
    client.test("Get available slots successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 18.2 Создать бронирование
POST {{baseUrl}}/reservations
Content-Type: application/json

{
  "restaurant_id": {{restaurant_id}},
  "table_id": {{table_id}},
  "customer_name": "Иван Петров",
  "customer_phone": "+79001234567",
  "customer_email": "ivan@example.com",
  "guest_count": 2,
  "reservation_date": "2025-12-01",
  "start_time": "19:00",
  "notes": "Столик у окна"
}

> {%
    client.test("Create reservation successful", function() {
        client.assert(response.status === 200 || response.status === 201, "Expected success");
    });

    if (response.body.data && response.body.data.id) {
        client.global.set("reservation_id", response.body.data.id);
    }
%}

### 18.3 Получить бронирования по телефону
GET {{baseUrl}}/reservations/my?phone=%2B79001234567

> {%
    client.test("Get reservations by phone successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 18.4 Получить все бронирования
GET {{baseUrl}}/reservations
Authorization: Bearer {{token}}

> {%
    client.test("Get all reservations successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });

    if (response.body.data && response.body.data.length > 0 && !client.global.get("reservation_id")) {
        client.global.set("reservation_id", response.body.data[0].id);
    }
%}

### 18.5 Получить бронирования ресторана
GET {{baseUrl}}/reservations/restaurant/{{restaurant_id}}
Authorization: Bearer {{token}}

> {%
    client.test("Get restaurant reservations successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 18.6 Обновить бронирование
PATCH {{baseUrl}}/reservations/{{reservation_id}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "guest_count": 3,
  "notes": "Добавился один гость"
}

> {%
    client.test("Update reservation successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 20.1 Обновить блюдо
PUT {{baseUrl}}/dishes/{{dish_bruschetta_id}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "menuCategoryId": {{category_antipasti_id}},
  "name": "Брускетта с томатами (обновлено)",
  "price": 480,
  "description": "Обновленное описание",
  "image": "https://example.com/bruschetta-new.jpg",
  "ingredients": [
    {"name": "Чиабатта", "quantity": 120},
    {"name": "Томаты черри", "quantity": 100}
  ],
  "allergens": [
    {"name": "Глютен", "description": "Содержится в хлебе"}
  ]
}

> {%
    client.test("Update dish successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 20.2 Обновить столик
PUT {{baseUrl}}/tables/{{table_id}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Столик №1 (VIP)",
  "guestCount": 2,
  "restaurantId": {{restaurant_id}}
}

> {%
    client.test("Update table successful", function() {
        client.assert(response.status === 200, "Expected status 200");
    });
%}

### 21.1 Запрос без авторизации
GET {{baseUrl}}/dishes

> {%
    client.test("Unauthorized request returns 401", function() {
        client.assert(response.status === 401, "Expected status 401");
    });
%}

### 21.2 Несуществующий endpoint
GET {{baseUrl}}/nonexistent
Authorization: Bearer {{token}}

> {%
    client.test("Non-existent endpoint returns 404", function() {
        client.assert(response.status === 404, "Expected status 404");
    });
%}

### 21.3 Создание с пустым телом
POST {{baseUrl}}/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{}

> {%
    client.test("Empty body returns validation error", function() {
        client.assert(response.status === 400 || response.status === 422, "Expected validation error");
    });
%}
